# Claude Code 멀티 에이전트 (Sub-agents)

> 작성일: 2026-02-23

## 핵심 개념

- **서브에이전트**란 특정 작업을 처리하는 전문화된 AI 어시스턴트
- 각 서브에이전트는 **독립적인 컨텍스트 창**에서 실행 → 메인 대화 오염 없음
- Claude가 작업 성격을 보고 적절한 서브에이전트에 **자동 위임**
- 서브에이전트는 다른 서브에이전트를 생성할 수 없음 (중첩 불가)

## 내장 서브에이전트

| 에이전트 | 모델 | 도구 | 용도 |
|---------|------|------|------|
| **Explore** | Haiku (빠름) | 읽기 전용 | 코드베이스 탐색/검색 |
| **Plan** | 상속 | 읽기 전용 | Plan Mode 시 컨텍스트 수집 |
| **General-purpose** | 상속 | 전체 | 복잡한 다단계 작업 |
| **Bash** | 상속 | 터미널 | 터미널 명령 실행 |

## 커스텀 서브에이전트 만들기

### 방법 1 — /agents 커맨드 (권장)

```
> /agents
```

→ 목록 확인, 신규 생성, 편집, 삭제 가능

### 방법 2 — 마크다운 파일 직접 작성

```markdown
---
name: code-reviewer
description: 코드 품질과 보안을 리뷰하는 전문가. 코드 변경 후 자동으로 사용.
tools: Read, Grep, Glob, Bash
model: sonnet
---

당신은 시니어 코드 리뷰어입니다.
코드 품질, 보안, 유지보수성을 검토하고 피드백을 제공하세요.
```

## 저장 위치 (우선순위)

| 위치 | 범위 | 우선순위 |
|------|------|----------|
| `--agents` CLI 플래그 | 현재 세션만 | 1 (최고) |
| `.claude/agents/` | 현재 프로젝트 | 2 |
| `~/.claude/agents/` | 모든 프로젝트 | 3 |
| 플러그인 `agents/` | 플러그인 범위 | 4 |

> 팀 공유는 `.claude/agents/`에 저장 후 git commit

## 주요 설정 옵션 (frontmatter)

```yaml
---
name: my-agent          # 필수. 고유 식별자
description: ...        # 필수. 언제 이 에이전트를 쓸지 설명
tools: Read, Grep, Bash # 허용 도구 (생략 시 전체 상속)
model: sonnet           # sonnet / opus / haiku / inherit(기본)
permissionMode: plan    # default / acceptEdits / dontAsk / plan
maxTurns: 10            # 최대 실행 턴 수
memory: user            # 영구 메모리: user / project / local
background: true        # true면 항상 백그라운드 실행
isolation: worktree     # 독립 git worktree에서 실행
---
```

## 사용법

### 자동 위임 (Claude가 판단)

Claude가 description을 보고 알아서 적절한 서브에이전트에 위임

### 명시적 요청

```
> code-reviewer 서브에이전트로 인증 모듈을 검토해줘
> test-runner 서브에이전트를 써서 실패한 테스트를 고쳐줘
```

### 병렬 실행

```
> 인증, 데이터베이스, API 모듈을 서브에이전트로 병렬 분석해줘
```

### 백그라운드 실행

```
> 이 작업을 백그라운드에서 실행해줘
```
또는 실행 중 `Ctrl+B`

## 포그라운드 vs 백그라운드

| 구분 | 특징 |
|------|------|
| **포그라운드** | 완료될 때까지 대기. 승인 요청을 사용자에게 전달 |
| **백그라운드** | 병렬 실행. 사전 권한 승인 필요. MCP 도구 사용 불가 |

## 서브에이전트 vs 메인 대화

| 메인 대화 사용 | 서브에이전트 사용 |
|--------------|----------------|
| 반복적인 대화가 필요할 때 | 대량 출력이 발생할 때 |
| 빠른 단순 작업 | 특정 도구만 허용하고 싶을 때 |
| 여러 단계가 컨텍스트를 공유할 때 | 독립적으로 완결되는 작업 |

## 실습 메모

- `description`에 "Use proactively"를 쓰면 Claude가 더 적극적으로 위임
- 서브에이전트는 다른 서브에이전트를 호출할 수 없음
- 백그라운드 서브에이전트 실패 시 포그라운드로 재시도 가능
- `/agents` 커맨드 없이 `claude agents` (CLI)로도 목록 확인 가능
- Explore 에이전트는 Haiku 모델 사용 → 빠르고 저렴

## 다음 학습 주제

- [ ] Agent Teams — 완전히 독립된 세션 간 에이전트 협력
- [x] Skills — 재사용 가능한 프롬프트/워크플로우
